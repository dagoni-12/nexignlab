# Микросервис для генерации CDR и UDR отчетов

Этот микросервис генерирует записи CDR (Call Data Records), предоставляет REST API для получения отчетов UDR (Usage Data Reports) и генерирует отчеты CDR.

## Описание
Этот проект является решением задачи Nexign Bootcamp 2025. Микросервис эмулирует работу коммутатора оператора связи, генерируя записи CDR, и предоставляет REST API для генерации отчетов UDR и CDR.

## Возможности
1) Генерирует записи CDR и сохраняет их в базу данных H2.
2) Предоставляет REST API для получения отчетов UDR.
3) Генерирует отчеты CDR для указанного абонента и периода.

## Используемые технологии
1) Java: OpenJDK 17
2) Spring Boot: Фреймворк для создания микросервиса.
3) H2 Database: Встроенная база данных для хранения данных CDR и UDR.
4) Микросервис для генерации CDR и UDR отчетов

### Установка
Предварительные условия
```Java 17```
```Maven```

### Шаги для запуска приложения
1) Клонируйте репозиторий:
```
git clone <URL вашего репозитория>
cd <папка проекта>
```
2) Соберите проект:
   ```mvn clean install```

3) Запустите приложение:
   ```mvn spring-boot:run```
   
### Доступ к консоли H2:
Откройте консоль H2: http://localhost:8080/h2-console.
Используйте следующие настройки для подключения:
```
Driver Class: org.h2.Driver
JDBC URL: jdbc:h2:~/test
Username: user_1
Password: password1
```
## Эндпоинты
### 1. Генерация записей CDR
```URL: POST /api/generate```

Описание: Генерирует записи CDR для списка абонентов за последний год.
Тело запроса: Нет

Ответ:
    
    {
        "message": "CDR records generated successfully."
    }

### 2. Получение UDR для абонента

```URL: GET /api/udr/{msisdn}?period=...```

Описание: Получает отчет UDR для конкретного абонента.
Параметры:

```msisdn``` (Path Variable): Номер абонента (MSISDN).

```period``` (Query Parameter, опционально): Период для генерации отчета (формат: YYYY-MM).

Ответ:

    {
        "msisdn": "79992221122",
        "incomingCall": {
            "totalTime": "02:12:13"
        },
        "outcomingCall": {
            "totalTime": "00:02:50"
        }
    }

### 3. Получение UDR для всех абонентов

```URL: GET /api/udr/all?period=...```

Описание: Получает отчеты UDR для всех абонентов.
Параметры:

```period``` (Query Parameter, опционально): Период для генерации отчета (формат: YYYY-MM).

Ответ:

    [
        {
            "msisdn": "79992221122",
            "incomingCall": {
                "totalTime": "02:12:13"
            },
            "outcomingCall": {
                "totalTime": "00:02:50"
            }
        },
        {
            "msisdn": "79992221123",
            "incomingCall": {
                "totalTime": "01:30:00"
            },
            "outcomingCall": {
                "totalTime": "00:45:00"
            }
        }
    ]

### 4. Генерация отчета CDR

```URL: POST /api/generate-report```

Описание: Генерирует отчет CDR для конкретного абонента и периода.
Параметры:

```msisdn``` (Query Parameter): Номер абонента (MSISDN).

```startTime``` (Query Parameter): Начальная дата и время для отчета (формат: YYYY-MM-DDTHH:MM:SS).

```endTime``` (Query Parameter): Конечная дата и время для отчета (формат: YYYY-MM-DDTHH:MM:SS).

Ответ:

    {
        "message": "Report generated successfully.",
        "requestId": "61f0c404-5cb3-11e7-907b-a6006ad3dba0"
    }

## Обработка ошибок
Приложение обрабатывает следующие ошибки:

    CdrNotFoundException: Возвращает статус 404 с сообщением об отсутствии записей CDR.
    IllegalArgumentException: Возвращает статус 400 с сообщением о некорректном формате периода.
    NumberFormatException: Возвращает статус 400 с сообщением о некорректном формате числа.
    DateTimeException: Возвращает статус 400 с сообщением о некорректном формате даты.

# Заключение
Этот микросервис предоставляет полное решение для генерации записей CDR, получения отчетов UDR и генерации отчетов CDR. Приложение построено с использованием Spring Boot и базы данных H2, и его легко расширить или изменить в соответствии с конкретными требованиями.Maven: Инструмент для управления зависимостями и сборки проекта.
